<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recent Searches</title>
    <link rel="icon" type="image/x-icon" href="logo image.jpg">
    <link rel="shortcut icon" type="image/x-icon" href="logo image.jpg">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <script src="assets/js/app.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/009d561cd5.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            background-color: #F0F0F0;
        }

        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 120px;
            background-color: #f8f9fa;
            padding: 20px;
            overflow-y: auto;
            margin-right: 10px;
        }

          .dropdown {
          position: relative;
          display: inline-block;
        }

        .dropdown:hover .dropdown-content {
          display: block;
        }

                .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 80px;
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
            z-index: 1;
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        .logo img {
            max-width: 100%;
            margin-bottom: 5px;
        }

        .ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            gap: 10px;
            width: 10px;
        }

        .ul li {
            display: inline-block;
        }

        .ul li a {
            display: block;
            padding: 10px;
            font-size: 18px;
            text-align: center;
            text-decoration: none;
            background-color: #f6f6f6;
            border: none;
            width: 10px;
        }

        .ul li a:hover {
            background-color: #eee;
        }

        .search-container {
            position: relative;
            display: flex; 
            align-items: center; 
            width: 300px;
        }

        #myInput {
            flex: 1; 
            font-size: 16px;
            padding: 12px 20px 12px 40px;
            border: 1px solid #ddd;
        }

        .search-icon,
        #profile {
            margin: 0 10px; 
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    
    <div class="sidebar">
        <!-- Menu items -->
        <a href="Homepage.html"> <img src="logo image.jpg" alt="Logo" style="height: 50px;"></a>
        <br><br><br><br><br><br>
        <div class="dropdown">
            <button class="dropbtn">‚ò∞</button>
            <div class="dropdown-content">
                <a href="ServiceDirectory.html">Service Directory</a>
                <a href="AboutUs.html">About Us</a>
                <a href="Contact.html">Contact Us</a>
                <!-- Add more menu items as needed -->
            </div>
        </div>
        <br><br><br><br><br><br>
        <a href="Recent.html">üïê</a>
        <br><br><br><br><br><br>
        <a href="information.html"><i class="fa-solid fa-circle-info"></i></a>
    </div>

    <div style="margin-left: 140px; padding: 20px;">
        <h1>Recent Searches</h1>

         <div style="display: flex; align-items: center; margin-bottom: 20px;">
            <div style="position: relative; display: inline-block;">
                <input type="text" id="myInput" placeholder="Search.." oninput="updateSearchHistory()" style="padding-left: 30px; padding: 10px 10px 10px 30px; width: 300px; border: 1px solid #ddd; border-radius: 4px;">
                <div style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%);" onclick="updateSearchHistory()"><i class="fa-solid fa-magnifying-glass"></i></div>
            </div>
            <a href="profile.html" style="margin-left: 20px; font-size: 24px; text-decoration: none;"><i class="fa-solid fa-user"></i></a>
        </div>
            
        <!-- Display recent searches here -->
        <div style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 700px;">
            <div style="display:flex; justify-content: space-between; align-items: center;">
              <h3 style="margin-top: 0;">Your Recent Searches</h3>
              <button id="clearHistory" class="btn btn-sm btn-outline-danger">Clear History</button>
            </div>
            <ul id="searchHistory" style="list-style-type: none; padding: 0; margin: 0;">
                <!-- Search history entries will be dynamically added here -->
            </ul>
        </div>
        
        <script>
            // Function to update search history based on user input
            function updateSearchHistory() {
                const searchInput = document.getElementById("myInput").value;
                if (searchInput.trim() !== "") {
                    // Get existing search history from localStorage
                    let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];
                    
                    // Add the search input to the beginning if it's not already there
                    if (!searchHistory.includes(searchInput)) {
                        searchHistory.unshift(searchInput);
                        // Keep only the last 10 searches
                        searchHistory = searchHistory.slice(0, 10);
                        // Save to localStorage
                        localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
                    }
                    
                    // Update the displayed search history
                    renderSearchHistory(searchHistory);
                }
            }

            // Function to render search history
            function renderSearchHistory(list) {
                const ul = document.getElementById("searchHistory");
                ul.innerHTML = "";
                if (!list || list.length === 0) {
                    ul.innerHTML = "<li style='color:#999;'>No recent searches</li>";
                    return;
                }
                list.forEach((item, idx) => {
                    // Support both V2 objects and legacy strings
                    const q = typeof item === 'string' ? item : item.q;
                    const ts = typeof item === 'string' ? null : item.ts;
                    const li = document.createElement('li');
                    li.style.display = 'flex';
                    li.style.alignItems = 'center';
                    li.style.justifyContent = 'space-between';
                    li.style.padding = '8px 0';
                    li.style.borderBottom = '1px solid #eee';

                    const left = document.createElement('div');
                    const link = document.createElement('a');
                    link.textContent = q;
                    link.href = 'Homepage.html?q=' + encodeURIComponent(q);
                    link.style.textDecoration = 'none';
                    link.style.color = '#007bff';
                    left.appendChild(link);

                    if (ts) {
                      const time = document.createElement('span');
                      const date = new Date(ts);
                      time.textContent = ' ‚Ä¢ ' + date.toLocaleString();
                      time.style.color = '#777';
                      time.style.fontSize = '12px';
                      left.appendChild(time);
                    }

                    const actions = document.createElement('div');
                    const del = document.createElement('button');
                    del.className = 'btn btn-sm btn-outline-secondary';
                    del.title = 'Remove';
                    del.innerHTML = '<i class="fa-solid fa-xmark"></i>';
                    del.onclick = function(){ deleteEntry(q); };

                    actions.appendChild(del);
                    li.appendChild(left);
                    li.appendChild(actions);
                    ul.appendChild(li);
                });
            }

            // Load and display search history on page load
                        function getHistory() {
                                try {
                                    const v2 = JSON.parse(localStorage.getItem('searchHistoryV2')) || [];
                                    if (v2 && v2.length) return v2;
                                    const legacy = JSON.parse(localStorage.getItem('searchHistory')) || [];
                                    return legacy.map(q => ({ q, ts: null }));
                                } catch(e) { return []; }
                        }

                        function setHistory(list) {
                            localStorage.setItem('searchHistoryV2', JSON.stringify(list));
                        }

                        function deleteEntry(q){
                            let list = getHistory().filter(item => item.q !== q);
                            setHistory(list);
                            renderSearchHistory(list);
                        }

                        document.getElementById('clearHistory').onclick = function(){
                            setHistory([]);
                            renderSearchHistory([]);
                        };

                        window.onload = function(){
                            const list = getHistory();
                            renderSearchHistory(list);
                        };
        </script>
    </div>
</body>
</html>
